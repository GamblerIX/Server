# 发行版运行指南

> 假设你准备在`{PATH}\Server`文件夹下运行项目。

## 环境配置

### 第一步：下载并安装Git：https://github.com/git-for-windows/git/releases/download/v2.50.1.windows.1/Git-2.50.1-64-bit.exe

- 一直点击Next，直到安装完成。

### 第二步：克隆项目

1. 打开 PowerShell（管理员）

2. 创建文件夹并克隆项目
   ```PowerShell
   New-Item -Path "{PATH}\" -ItemType Directory -Force
   cd "{PATH}\"
   git clone https://github.com/GamblerIX/Server.git
   ```

  - 对于中国大陆用户，请执行以下代码：
    ```PowerShell
    New-Item -Path "{PATH}\" -ItemType Directory -Force
    cd "{PATH}\"
    git clone https://gitee.com/GamblerIX/Server.git
    ```

3. 设置文件夹权限
   ```PowerShell
   icacls "{PATH}\" /grant Users:F /T
   ```

### 第三步：下载并安装 PostgreSQL 数据库：https://get.enterprisedb.com/postgresql/postgresql-17.5-3-windows-x64.exe

> 安装时根据提示设置 postgres 用户密码：`Aa123456`

> 创建数据库与用户（以 PowerShell 运行）：
```PowerShell
Set-Location "C:\Program Files\PostgreSQL\17\bin"
.\psql -U postgres -h 127.0.0.1 -p 5432
```

> 输入密码：`Aa123456`

> 继续输入：
```PowerShell
CREATE DATABASE users;
CREATE USER users WITH PASSWORD 'password';
\c users
GRANT CREATE, USAGE ON SCHEMA public TO users;
GRANT ALL PRIVILEGES ON ALL TABLES IN SCHEMA public TO users;
ALTER DEFAULT PRIVILEGES IN SCHEMA public GRANT ALL PRIVILEGES ON TABLES TO users;
```
> 若没有报错则关闭PowerShell。

### 第四步：安装 Python：https://www.python.org/ftp/python/3.13.7/python-3.13.7-amd64.exe

- 安装时勾选「Add to PATH」

### ✅ 环境验证

```PowerShell
python --version
git --version
```

## 💻 客户端配置

### 💾 下载客户端

1. 访问链接：<https://www.123865.com/s/87lLTd-nUt3A?pwd=r1nx> 并下载你想玩的版本。以下假设你想玩的是{x.y}版本。
> 声明：客户端使用123云盘分享没有任何牟利目的。
> 也可访问源码作者提供的客户端下载链接：https://onedrive.060810.xyz/s/7Xfl / https://gofile.io/d/32LUct / https://transfer.it/t/kWsuycphCDqa

2. 存在四种推荐下载方法：
   1. PC登录直接下载（需要会员）
   2. 手机登录下载传到PC端（不限速但麻烦）
   3. PC端浏览器安装篡改猴插件，然后直接访问链接：<https://scriptcat.org/scripts/code/2385/123%20%E4%BA%91%E7%9B%98%E4%BC%9A%E5%91%98%E9%9D%92%E6%98%A5%E7%89%88.user.js>，选择安装脚本，然后登陆下载。（不限速但略微麻烦）
   4. 通过源码作者提供的客户端下载链接下载。
   
3. 解压下载的压缩包到`{PATH}\Client`文件夹，确保`Wuthering Waves.exe`在`{PATH}\Client`文件夹内。

4. 执行以下命令：
   ```PowerShell
   cd "{PATH}\Server"
   python wuwa_server.py --patch --version {x.y}
   ```

> {}不用保留。这只是一个变量的标志。例如：
> python wuwa_server.py --patch --version 2.7

## ⚙️ 高级配置

### 🗄️ 数据库默认配置

```
host = "127.0.0.1:5432"
user_name = "users"
password = "password"
db_name = "users"
```

### 🌐 服务端口

| 服务 | 端口 | 描述 |
|------|------|------|
| configserver | 10001 | 配置服务器 |
| loginserver | 5500 | 登录服务器 |
| gateway | 10003 | 网关服务器 |
| kcpport | 7777 | KCP传输端口 |
| gameserver | 10004 | 游戏服务器 |
| hotpatch | 10002 | 热更新服务器 |

## 🔧 命令行参数

### 基础参数（必须且仅选一个）：
  --run         启动服务端
  --patch       应用补丁
  --status      查看状态
  --stop        停止服务端
  --check       环境检查
  --ddsr        下载服务端发行版

### 可叠加参数：
  --serveronly  仅服务端
  --clientonly  仅客户端
  --all         全部
  --version     指定版本 (格式: x.y)

### 参数叠加规则：
  --run:
    默认: --serveronly
    可叠加: --serveronly, --clientonly, --all

  --patch:
    必须叠加: --version x.y
    不可叠加其他参数

  --status:
    默认: --serveronly
    可叠加: --serveronly, --clientonly, --all
    不可叠加: --version

  --stop:
    默认: --serveronly
    仅可叠加: --serveronly

  --check:
    默认: --all
    可叠加: --serveronly, --clientonly, --all
    不可叠加: --version

  --ddsr:
    必须叠加: --version x.y
    不可叠加其他参数

### 🎯 使用示例
  python wuwa_server.py --run
  python wuwa_server.py --run --clientonly
  python wuwa_server.py --patch --version 1.0
  python wuwa_server.py --status --all
  python wuwa_server.py --stop
  python wuwa_server.py --check --serveronly
  python wuwa_server.py --ddsr --version 2.7


## ⚠️ 已知问题

> 客户端必须以管理员身份启动，脚本会自动申请权限。

> 自2.7版本起，必须先启动服务端再启动客户端，否则客户端会提示远程配置获取失败。