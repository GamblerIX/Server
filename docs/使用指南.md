# 完整使用指南

本指南将帮助您在Windows上一步步运行鸣潮服务端和客户端，以游玩鸣潮测试服。

## 环境配置

### 第一步：安装Git

   * 访问链接下载后安装：<https://github.com/git-for-windows/git/releases/download/v2.50.1.windows.1/Git-2.50.1-64-bit.exe>

### 第二步：克隆项目

1. 打开 PowerShell（管理员）

2. 创建文件夹并克隆项目
   ```PowerShell
   New-Item -Path "C:\{PATH}\" -ItemType Directory -Force
   cd "C:\{PATH}\"
   git clone https://github.com/GamblerIX/Server.git
   ```

3. 设置文件夹权限
   ```PowerShell
   icacls "C:\{PATH}\" /grant Users:F /T
   ```

---

### 第三步：安装和配置 PostgreSQL 数据库

1) 下载并安装：<https://get.enterprisedb.com/postgresql/postgresql-17.5-3-windows-x64.exe>

2) 安装时设置 postgres 用户密码：`Aa123456`

3) 创建数据库与用户（以 PowerShell 运行）：
   ```PowerShell
   Set-Location "C:\Program Files\PostgreSQL\17\bin"
   .\psql -U postgres -h 127.0.0.1 -p 5432
   ```

   接着依次执行：
   ```PowerShell
   CREATE DATABASE users;
   CREATE USER users WITH PASSWORD 'password';
   \c users
   GRANT CREATE, USAGE ON SCHEMA public TO users;
   GRANT ALL PRIVILEGES ON ALL TABLES IN SCHEMA public TO users;
   ALTER DEFAULT PRIVILEGES IN SCHEMA public GRANT ALL PRIVILEGES ON TABLES TO users;
   \q
   ```

### 第四步：安装 Python

1) 下载：<https://www.python.org/ftp/python/3.13.6/python-3.13.6-amd64.exe>

2) 安装时勾选「Add to PATH」

### ✅ 环境验证

```PowerShell
python --version
git --version
```
PostgreSQL 可通过开始菜单的 pgAdmin 4 验证。

## 客户端配置

### 下载客户端

1. 访问链接：<https://www.123865.com/s/87lLTd-nUt3A?pwd=r1nx>
> 声明：客户端使用123云盘分享没有任何牟利目的。

2. 存在三种推荐下载方法：
   1. PC登录直接下载（需要会员）
   2. 手机登录下载传到PC端（不限速但麻烦）
   3. PC端浏览器安装篡改猴插件，然后直接访问链接：<https://scriptcat.org/scripts/code/2385/123%20%E4%BA%91%E7%9B%98%E4%BC%9A%E5%91%98%E9%9D%92%E6%98%A5%E7%89%88.user.js>，选择安装脚本，然后登陆下载。（不限速但略微麻烦）

3. 解压下载的压缩包到`C:\{PATH}\Client`文件夹，确保`Wuthering Waves.exe`在`C:\{PATH}\Client`文件夹内。

### 补丁客户端

```PowerShell
python wuwa_server.py --patchclient --version 2.6
```

> 将2.6替换为实际游戏版本号。

## 运行服务端和客户端

```PowerShell
python wuwa_server.py --patchclient --version 2.6
```

进入游戏后不要使用快速新建/登录，可使用任意 ID 进入。

## 数据库配置摘要

```
host = "127.0.0.1:5432"
user_name = "users"
password = "password"
db_name = "users"
```


## 命令行使用方式

所有命令需在 `Server` 目录下执行：

```PowerShell
cd "C:\{PATH}\Server"
pip install -r requirements.txt
```

- 启动服务端（自动选择最新 release 版本，或使用 --version 指定）
  ```PowerShell
  python wuwa_server.py --run [--version 2.6]
  ```
- 停止所有服务端
  ```PowerShell
  python wuwa_server.py --stop
  ```
- 显示服务端状态
  ```PowerShell
  python wuwa_server.py --status
  ```
- 调试运行（分窗口启动各服务端）
  ```PowerShell
  python wuwa_server.py --debug [--version 2.6]
  ```
- 环境检查（按指定或最新版本）
  ```PowerShell
  python wuwa_server.py --check [--version 2.6]
  ```
- 仅检查服务端环境
  ```PowerShell
  python wuwa_server.py --check --server-only [--version 2.6]
  ```
- 仅检查客户端环境
  ```PowerShell
  python wuwa_server.py --check --client-only [--version 2.6]
  ```
- 应用客户端补丁
  ```PowerShell
  python wuwa_server.py --patchclient --version 2.6
  ```
- 同时启动服务端和应用客户端补丁
  ```PowerShell
  python wuwa_server.py --runserverandclient --version 2.6
  ```

## 角色技能充能

全文替换修改 `Server/release/<版本>/data/assets/game-data/BinData/BaseProperty.json` 的以下字段：
```json
{
  "CdReduse": 0,
  "EnergyMax": 0,
  "Energy": 1
}
```
这样就能实现无CD与满能量效果。

## 🌐 服务端口

| 服务 | 端口 | 描述 |
|------|------|------|
| configserver | 10001 | 配置服务器 |
| loginserver | 5500 | 登录服务器 |
| gateway | 10003 | 网关服务器 |
| kcpport | 7777 | KCP传输端口 |
| gameserver | 10004 | 游戏服务器 |
| hotpatch | 10002 | 热更新服务器 |
